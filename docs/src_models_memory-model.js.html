<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/models/memory-model.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/models/memory-model.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

/**
 * @file Memory Data Model
 * @module src/models/memory-model
 * @requires {@link https://github.com/kelektiv/node-uuid uuid}
 */

const uuid = require('uuid/v4')

const schema = {
  _id: { required: true },
  name: { required: true },
  display_name: { required: true },
  not_required: { required: false },
  required_not_specified: { something: 10 }
}

let requiredFields = Object.entries(schema).reduce(
  (arr, [key, { required }]) => {
    if (required) arr.push(key)
    return arr
  },
  []
)

/**
 * Creates an instance of a memory Model.
 * @param {object} schema An outline of the fields and pieces of data that are required by each data model. This may vary in each Model instance, e.g., the Players data model may have different required fields in its schema than the Teams data model.
 */

/** Class representing a memory data model with CRUD methods */
class MemoryModel {
  /**
   * Model constructor
   * @param {object} schema 
   * @memberof Categories
   */
  constructor(schema) {
    this.db = []
    this.schema = schema
    this.requiredFields = Object.entries(schema).reduce(
      (arr, [field, { required }]) => {
        if (required) arr.push(field)
        return arr
      },
      []
    )
  }

  /**
   * Retrieves an individual record (by id) or a list of all records
   * @param {string} _id Unique identifier of an individual record
   * @returns {Promise&lt;array|object>} A promise that contains the individual record of the _id provided or an array of all records in the model
   */
  get(_id) {
    let response
    if (_id) {
      this.existsInDB(_id) // throws if _id doesn't exist
      response = this.db.filter(record => record._id === _id)[0]
    } else {
      response = this.db
    }

    return Promise.resolve(response)
  }

  /**
   * Creates a new record with a unique _id property
   * @param {object} entry New record entry matching the format of the schema
   * @returns {Promise&lt;object>} A promise that contains the record created
   */
  post(entry) {
    entry._id = uuid()
    this.hasAllRequiredFields(entry) // throws if required fields are missing
    this.db.push(entry)
    return Promise.resolve(entry)
    // return this.get(entry._id)
  }

  /**
   * Replaces an entire individual record in the database
   * @param {string} id Unique identifier of an individual record (UUID format)
   * @param {object} entry New record entry matching the format of the schema
   * @returns {function} 
   */
  put(_id, entry) {
    this.existsInDB(_id)
    entry._id = _id
    this.hasAllRequiredFields(entry)

    this.db = this.db.map(dbRecord =>
      dbRecord._id === _id ? (dbRecord = entry) : dbRecord
    )

    // TODO: Consider mutable method below
    // const idx = this.db.findIndex(record => record._id === _id) // find the record
    // this.db[idx] = entry

    return this.get(_id)
  }

  patch(_id, updates) {
    this.existsInDB(_id)
    this.db = this.db.map(record =>
      record._id === _id ? (record = { ...record, ...updates }) : record
    )
    return this.get(_id)
  }

  /**
   * Deletes an individual record from the database
   * @param {string} _id Unique identifier of an individual record
   * @returns {Promise&lt;object>} A promise that contains an empty object
   */
  delete(_id) {
    this.existsInDB(_id)
    this.db = this.db.filter(record => record._id !== _id)
    // TODO: See if mutable method below works instead of current filter method

    // const idx = this.db.findIndex(record => record._id === _id) // find the record
    // this.db.splice(idx, 1) // delete the record
    return Promise.resolve({})
  }

  hasAllRequiredFields(entry) {
    for (const field in schema) {
      if (schema[field].required &amp;&amp; !entry[field])
        throw {
          status: 400,
          name: `Missing Required Field: ${field}`,
          message: `Invalid entry: must contain all required fields: ${requiredFields.join(
            ', '
          )}.`
        }
    }
  }

  existsInDB(_id) {
    // if (!this.db.findIndex(record => record._id === _id)
    if (!this.db.map(record => record._id).includes(_id))
      throw {
        status: 404,
        name: `Record Not Found`,
        message: `No records with _id: ${_id} found.`
      }
  }

  // echo '{"username":"&lt;yourusername>", "password":"&lt;yourpassword>", "role":"role"}' | http :&lt;yourPORT>/signup
  // echo '{"name":"clothing", "display_name":"Clothing, Shoes, Jewelry &amp; Watches"}' | http :3000/categories
  // echo '{"name":"electronics", "display_name":"Electronics, Computers &amp; Office", "not_required":"something here that is not required"}' | http :3000/categories

  // echo '{"name":"foobar", "display_name":"Clothing, Shoes, Jewelry &amp; Watches", "not_required":"a new thing"}' | http PUT :3000/categories/3038cf84-b49b-4790-8d86-232d78a7fd8e
  // }
}

module.exports = MemoryModel
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="index.module_js.html">index.js</a></li><li><a href="module-middleware_404.html">middleware/404</a></li><li><a href="module-middleware_500.html">middleware/500</a></li><li><a href="module-src_app.html">src/app</a></li><li><a href="module-src_models_memory-model.html">src/models/memory-model</a></li></ul><h3>Classes</h3><ul><li><a href="module-src_models_memory-model-MemoryModel.html">MemoryModel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Aug 23 2019 12:13:38 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
